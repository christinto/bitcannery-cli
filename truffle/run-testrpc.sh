#!/bin/sh
set -e

restart=1

trap "exit" INT TERM
trap "stop" EXIT

start_testrpc() {
  ./node_modules/.bin/testrpc \
    --account="0xefe3554153962a2658215320b1feb4a68786bac8c3360f66cab13011c588bf73,2222000000000000000000" \
    --account="0xc0ac892cadd05649068eb6270c6def64caa6866a8d8ac92ba5b3f1fd766d74cd,123000000000000000000" \
    --account="0xc49306a5858d34b3a1062e95bef2cf1ca8d7d6cf013f3ae5b81843d348e5c620,222000000000000000000" \
    --account="0xe730a15f301798c2d938c463d4d88e303581b0151518cc3d465c924b7da5173d,222000000000000000000" \
    --account="0x1c122fe01684f150658e32d2362e0426f3a4fbac3e7488d07e181967e3c17ef8,222000000000000000000" \
    --account="0x81e81afd54820094f6d9966bdd30b5af5c4acb8641a84cfbebea160f16ed1976,222000000000000000000" \
    --account="0xe089d5c0c815d25120a646d0ca9fb8e88b05862fabfbb7d15fa1e9b4bf0e4813,222000000000000000000" \
    --account="0x829abc696256e00b26c6a1af954024b205b4965edb91112cfcf570ea2c1c3a4e,222000000000000000000" \
    --account="0x17047c95bb1f83d49f764604a30c506c1f59e8a9997e6bdbac4611b18c4d617d,222000000000000000000" \
    -b 1
}

stop() {
  restart=0
  kill 0
}

# Restart TestRPC if it fails.
#
while [ "$restart" = 1 ]; do
  start_testrpc || true
  echo 'TestRPC failed, restarting'
done
